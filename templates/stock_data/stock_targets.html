<div
  class="bg-white bg-opacity-20 border border-white border-opacity-30 p-6 rounded-xl shadow-lg
         backdrop-filter backdrop-saturate-150 backdrop-brightness-110
         transition-shadow duration-300 ease-in-out hover:shadow-[0_15px_40px_rgba(59,130,246,0.4)]"
  style="box-shadow:
         inset 0 1px 0 rgba(255, 255, 255, 0.6),
         0 4px 15px rgba(14, 165, 233, 0.3);"
>
    <h3
      class="text-xl lg:text-2xl font-bold text-blue-700 mb-4 shadow-md"
      style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
             background-color: rgba(230, 247, 255, 0.4);
             padding: 12px; border-radius: 8px;"
    >
        Stock Targets
    </h3>

    <div id="stock-targets-grid" class="grid grid-cols-2 gap-4 text-white font-bold text-center"></div>

    <div
      id="analyst-opinion"
      class="mt-4 p-4 bg-white bg-opacity-25 rounded-lg shadow-md text-center
             backdrop-filter backdrop-saturate-150 backdrop-brightness-105"
      style="box-shadow: inset 0 0 10px rgba(255,255,255,0.4);"
    >
        <div class="text-lg font-semibold text-gray-700">Analyst Opinions</div>
        <div id="analyst-count" class="text-2xl font-bold text-blue-600"></div>
    </div>

    <div
      id="recommendation"
      class="mt-4 p-4 bg-white bg-opacity-25 rounded-lg shadow-md text-center
             backdrop-filter backdrop-saturate-150 backdrop-brightness-105"
      style="box-shadow: inset 0 0 10px rgba(255,255,255,0.4);"
    >
        <div class="text-lg font-semibold text-gray-700">Overall Recommendation</div>
        <div id="recommendation-text" class="text-2xl font-bold text-green-600"></div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var cmp = {{ data["Targets"]["Current Price"] }};
        var minTarget = {{ data["Targets"]["Lowest Target Price"] }};
        var avgTarget = {{ data["Targets"]["Average Target Price"] }};
        var maxTarget = {{ data["Targets"]["Highest Target Price"] }};
        var analystOpinions = {{ data["Targets"]["No of Analyst Opinions"] }};
        var recommendation = "{{ data["Targets"]["Recommendation"] }}";

        let stockTargets = [
            { label: "CMP", value: cmp, color: "blue" },
            { label: "Min Target", value: minTarget },
            { label: "Avg Target", value: avgTarget },
            { label: "Max Target", value: maxTarget }
        ];

        stockTargets.sort((a, b) => a.value - b.value);

        let minValue = Math.min(minTarget, avgTarget, maxTarget);
        let maxValue = Math.max(minTarget, avgTarget, maxTarget);

        function getColorShade(value, cmp) {
            let minIntensity = 200;
            let maxIntensity = 300;
            let range = maxValue - minValue || 1;
            let position = (value - minValue) / range;
            let intensity_red = Math.floor(position * (maxIntensity - minIntensity)) + minIntensity;
            let intensity_green = 100 - Math.floor(position * (maxIntensity - minIntensity)) + minIntensity;

            return value >= cmp
                ? `rgb(0, ${intensity_green}, 0)`
                : `rgb(${intensity_red}, 0, 0)`;
        }

        stockTargets.forEach(item => {
            if (item.label !== "CMP") {
                item.color = getColorShade(item.value, cmp);
            }
        });

        let container = document.querySelector("#stock-targets-grid");
        container.innerHTML = stockTargets.map(item => `
            <div class="p-4 rounded-lg"
                 style="background-color: ${item.color};
                        box-shadow: 0 4px 6px rgba(0,0,0,0.15);
                        transition: transform 0.3s ease-in-out;"
                 onmouseover="this.style.transform='scale(1.05)';"
                 onmouseout="this.style.transform='scale(1)';"
            >
                ${item.label}<br>${item.value.toFixed(2)}
            </div>
        `).join('');

        document.querySelector("#analyst-count").textContent = analystOpinions;
        document.querySelector("#recommendation-text").textContent = recommendation;
    });
</script>
